<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.busniess.dao.TalentDemandDao">

    <sql id="columnNames">
                d.id,d.user_name,d.title,d.content,d.engaged_industry,d.engaged_industry_detail,d.industry_experience,d.technology_scope,d.research_direction,
                d.demands_type,d.people_num,d.remuneration,d.salary,d.contact,d.phone_num,d.status,d.approval_status,d.approval_opinion,d.create_time,d.update_time,
                b.firmName companyName,b.country province,b.city,b.district
            </sql>

    <sql id="addColumnNames">
                user_name,
                title,
                content,
                engaged_industry,
                engaged_industry_detail,
                industry_experience,
                technology_scope,
                research_direction,
                demands_type,
                people_num,
                remuneration,
                salary,
                contact,
                phone_num,
                create_time
            </sql>

    <sql id="attrnames">
                #{userName},
                #{title},
                #{content},
                #{engagedIndustry},
                #{engagedIndustryDetail},
                #{industryExperience},
                #{technologyScope},
                #{researchDirection},
                #{demandsType},
                #{peopleNum},
                #{remuneration},
                #{salary},
                #{contact},
                #{phoneNum},
                #{createTime}
            </sql>

    <update id="updateById" parameterType="talentDemandEntity">
        update talent_demand
        <set>
            <if test="title!=null and title!=''">
                title=#{title},
            </if>
            <if test="content!=null and content!=''">
                content=#{content},
            </if>
            <if test="engagedIndustry!=null and engagedIndustry!=''">
                engaged_industry=#{engagedIndustry},
            </if>
            <if test="engagedIndustryDetail!=null and engagedIndustryDetail!=''">
                engaged_industry_detail=#{engagedIndustryDetail},
            </if>
            <if test="industryExperience!=null and industryExperience!=''">
                industry_experience=#{industryExperience},
            </if>
            <if test="technologyScope!=null and technologyScope!=''">
                technology_scope=#{technologyScope},
            </if>
            <if test="researchDirection!=null and researchDirection!=''">
                research_direction=#{researchDirection},
            </if>
            <if test="demandsType!=null and demandsType!=''">
                demands_type=#{demandsType},
            </if>
            <if test="peopleNum!=null and peopleNum!=''">
                people_num=#{peopleNum},
            </if>
            <if test="remuneration!=null and remuneration!=''">
                remuneration=#{remuneration},
            </if>
            <if test="salary!=null and salary!=''">
                salary=#{salary},
            </if>
            <if test="contact!=null and contact!=''">
                contact=#{contact},
            </if>
            <if test="phoneNum!=null and phoneNum!=''">
                phone_num=#{phoneNum},
            </if>
            <if test="status!=null">
                status=#{status},
            </if>
            <if test="approvalStatus!=null">
                approval_status=#{approvalStatus},
            </if>
            <if test="approvalOpinion!=null and approvalOpinion!=''">
                approval_opinion=#{approvalOpinion},
            </if>
            <if test="createTime!=null and createTime!=''">
                create_time=#{createTime},
            </if>
            <if test="updateTime!=null and updateTime!=''">
                update_time=#{updateTime},
            </if>
        </set>
        where id = #{id}
    </update>

    <select id="search" resultType="talentDemandEntity" parameterType="talentDemandEntity">
        select <include refid="columnNames"></include> from talent_demand d,businesscenter b
        <where>
            d.user_name = b.uname and b.statue=1 and d.del_flag = 0
            <if test="userName!=null and userName!=''">
                and d.user_name=#{userName}
            </if>
            <if test="engagedIndustry!=null and engagedIndustry!=''">
                and d.engaged_industry=#{engagedIndustry}
            </if>
            <if test="engagedIndustryDetail!=null and engagedIndustryDetail!=''">
                and d.engaged_industry_detail=#{engagedIndustryDetail}
            </if>
            <if test="industryExperience!=null and industryExperience!=''">
                and d.industry_experience=#{industryExperience}
            </if>
            <if test="technologyScope!=null and technologyScope!=''">
                and d.technology_scope=#{technologyScope}
            </if>
            <if test="researchDirection!=null and researchDirection!=''">
                and d.research_direction=#{researchDirection}
            </if>
            <if test="demandsType!=null and demandsType!=''">
                and d.demands_type=#{demandsType}
            </if>
            <if test="status!=null">
                and d.status=#{status}
            </if>
            <if test="approvalStatus!=null">
                and d.approval_status=#{approvalStatus}
            </if>
            <if test="companyName!=null and companyName!=''">
                and b.firmName=#{companyName}
            </if>
            <if test="keyWord!=null and keyWord!=''">
                and (d.`engaged_industry` like CONCAT('%',#{keyWord},'%') or d.`engaged_industry_detail` like
                CONCAT('%',#{keyWord},'%') or d.`title` like CONCAT('%',#{keyWord},'%'))
            </if>
        </where>
    </select>
</mapper>